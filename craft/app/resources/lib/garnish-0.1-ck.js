/**
 * Garnish UI toolkit
 *
 * @copyright 2013 Pixel & Tonic, Inc.. All rights reserved.
 * @author    Brandon Kelly <brandon@pixelandtonic.com>
 * @version   0.1
 * @license   THIS IS NO F.O.S.S!
 */(function(e){var t=function(){};t.extend=function(e,n){var r=t.prototype.extend;t._prototyping=!0;var i=new this;r.call(i,e);i.base=function(){};delete t._prototyping;var s=i.constructor,o=i.constructor=function(){if(!t._prototyping)if(this._constructing||this.constructor==o){this._constructing=!0;s.apply(this,arguments);delete this._constructing}else if(arguments[0]!=null)return(arguments[0].extend||r).call(arguments[0],i)};o.ancestor=this;o.extend=this.extend;o.forEach=this.forEach;o.implement=this.implement;o.prototype=i;o.toString=this.toString;o.valueOf=function(e){return e=="object"?o:s.valueOf()};r.call(o,n);typeof o.init=="function"&&o.init();return o};t.prototype={extend:function(e,n){if(arguments.length>1){var r=this[e];if(r&&typeof n=="function"&&(!r.valueOf||r.valueOf()!=n.valueOf())&&/\bbase\b/.test(n)){var i=n.valueOf();n=function(){var e=this.base||t.prototype.base;this.base=r;var n=i.apply(this,arguments);this.base=e;return n};n.valueOf=function(e){return e=="object"?n:i};n.toString=t.toString}this[e]=n}else if(e){var s=t.prototype.extend;!t._prototyping&&typeof this!="function"&&(s=this.extend||s);var o={toSource:null},u=["constructor","toString","valueOf"],a=t._prototyping?0:1;while(f=u[a++])e[f]!=o[f]&&s.call(this,f,e[f]);for(var f in e)o[f]||s.call(this,f,e[f])}return this}};t=t.extend({constructor:function(){this.extend(arguments[0])}},{ancestor:Object,version:"1.1",forEach:function(e,t,n){for(var r in e)this.prototype[r]===undefined&&t.call(n,e[r],r,e)},implement:function(){for(var e=0;e<arguments.length;e++)typeof arguments[e]=="function"?arguments[e](this.prototype):this.prototype.extend(arguments[e]);return this},toString:function(){return String(this.valueOf())}});if(typeof Garnish!="undefined")throw"Garnish is already defined!";Garnish={$win:e(window),$doc:e(document),$bod:e(document.body)};Garnish.rtl=Garnish.$bod.hasClass("rtl");Garnish.ltr=!Garnish.rtl;Garnish=e.extend(Garnish,{DELETE_KEY:8,SHIFT_KEY:16,CTRL_KEY:17,ALT_KEY:18,RETURN_KEY:13,ESC_KEY:27,SPACE_KEY:32,LEFT_KEY:37,UP_KEY:38,RIGHT_KEY:39,DOWN_KEY:40,A_KEY:65,S_KEY:83,CMD_KEY:91,PRIMARY_CLICK:1,SECONDARY_CLICK:3,X_AXIS:"x",Y_AXIS:"y",TEXT_NODE:3,log:function(e){typeof console!="undefined"&&typeof console.log=="function"&&console.log(e)},_isMobileBrowser:null,_isMobileOrTabletBrowser:null,isMobileBrowser:function(e){var t=e?"_isMobileOrTabletBrowser":"_isMobileBrowser";if(Garnish[t]===null){var n=navigator.userAgent||navigator.vendor||window.opera;Garnish[t]=(new RegExp("(android|bbd+|meego).+mobile|avantgo|bada/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)/|plucker|pocket|psp|series(4|6)0|symbian|treo|up.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino"+(e?"|android|ipad|playbook|silk":""),"i")).test(n)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(n.substr(0,4))}return Garnish[t]},isArray:function(e){return e instanceof Array},isJquery:function(e){return e instanceof jQuery},isString:function(e){return typeof e=="string"},isTextNode:function(e){return e.nodeType==Garnish.TEXT_NODE},getDist:function(e,t,n,r){return Math.sqrt(Math.pow(e-n,2)+Math.pow(t-r,2))},hitTest:function(t,n,r){Garnish.hitTest._$elem=e(r);Garnish.hitTest._offset=Garnish.hitTest._$elem.offset();Garnish.hitTest._x1=Garnish.hitTest._offset.left;Garnish.hitTest._y1=Garnish.hitTest._offset.top;Garnish.hitTest._x2=Garnish.hitTest._x1+Garnish.hitTest._$elem.outerWidth();Garnish.hitTest._y2=Garnish.hitTest._y1+Garnish.hitTest._$elem.outerHeight();return t>=Garnish.hitTest._x1&&t<Garnish.hitTest._x2&&n>=Garnish.hitTest._y1&&n<Garnish.hitTest._y2},isCursorOver:function(e,t){return Garnish.hitTest(e.pageX,e.pageY,t)},copyTextStyles:function(t,n){var r=e(t),i=e(n);i.css({fontFamily:r.css("fontFamily"),fontSize:r.css("fontSize"),fontWeight:r.css("fontWeight"),letterSpacing:r.css("letterSpacing"),lineHeight:r.css("lineHeight"),textAlign:r.css("textAlign"),textIndent:r.css("textIndent"),whiteSpace:r.css("whiteSpace"),wordSpacing:r.css("wordSpacing"),wordWrap:r.css("wordWrap")})},getBodyScrollTop:function(){Garnish.getBodyScrollTop._scrollTop=document.body.scrollTop;if(Garnish.getBodyScrollTop._scrollTop<0)Garnish.getBodyScrollTop._scrollTop=0;else{Garnish.getBodyScrollTop._maxScrollTop=Garnish.$bod.outerHeight()-Garnish.$win.height();Garnish.getBodyScrollTop._scrollTop>Garnish.getBodyScrollTop._maxScrollTop&&(Garnish.getBodyScrollTop._scrollTop=Garnish.getBodyScrollTop._maxScrollTop)}return Garnish.getBodyScrollTop._scrollTop},scrollContainerToElement:function(t,n){var r=e(t),i=e(n),s=r.scrollTop(),o=i.offset().top;if(r[0]==window)var u=o-s;else var u=o-r.offset().top;if(u<0)r.scrollTop(s+u);else{var a=i.outerHeight(),f=r[0]==window?window.innerHeight:r[0].clientHeight;u+a>f&&r.scrollTop(s+(u-(f-a)))}},SHAKE_STEPS:10,SHAKE_STEP_DURATION:25,shake:function(t,n){var r=e(t);n||(n="margin-left");var i=parseInt(r.css(n));isNaN(i)&&(i=0);for(var s=0;s<=Garnish.SHAKE_STEPS;s++)(function(e){setTimeout(function(){Garnish.shake._properties={};Garnish.shake._properties[n]=i+(e%2?-1:1)*(10-e);r.animate(Garnish.shake._properties,Garnish.SHAKE_STEP_DURATION)},Garnish.SHAKE_STEP_DURATION*e)})(s)},getElement:function(t){return e.makeArray(t)[0]},getInputBasename:function(t){var n=e(t).attr("name");return n?n.replace(/\[.*/,""):null},getInputPostVal:function(e){var t=e.attr("type"),n=e.val();return t=="checkbox"||t=="radio"?e.prop("checked")?n:null:Garnish.isArray(n)&&e.attr("name").substr(-2)!="[]"?n.length?n[n.length-1]:null:n},findInputs:function(t){return e(t).find("input,text,textarea,select,button")},getPostData:function(t){var n={},r={},i=Garnish.findInputs(t);for(var s=0;s<i.length;s++){var o=e(i[s]);if(o.prop("disabled"))continue;var u=o.attr("name");if(!u)continue;var a=Garnish.getInputPostVal(o);if(a===null)continue;var f=u.substr(-2)=="[]";if(f){var l=u.substring(0,u.length-2);typeof r[l]=="undefined"&&(r[l]=0)}Garnish.isArray(a)||(a=[a]);for(var c=0;c<a.length;c++){if(f){var u=l+"["+r[l]+"]";r[l]++}n[u]=a[c]}}return n}});Garnish.Base=t.extend({settings:null,_eventHandlers:null,_namespace:null,_$listeners:null,constructor:function(){this._eventHandlers=[];this._namespace=".Garnish"+Math.floor(Math.random()*1e9);this._$listeners=e();this.init.apply(this,arguments)},init:e.noop,setSettings:function(t,n){var r=typeof this.settings=="undefined"?{}:this.settings;this.settings=e.extend({},r,n,t)},on:function(e,t,n){if(typeof t=="function"){n=t;t={}}var e=this._normalizeEvents(e);for(var r=0;r<e.length;r++){var i=e[r];this._eventHandlers.push({type:i[0],namepsace:i[1],data:t,handler:n})}},off:function(e){var e=this._normalizeEvents(e);for(var t=0;t<e;t++){var n=e[t];for(var r=this._eventHandlers.length-1;r>=0;t--){var i=this._eventHandlers[r];i.type==n[0]&&(!n[1]||i.namespace==n[1])&&this._eventHandlers.splice(r,1)}}},trigger:function(t,n){var r={type:t,target:this};typeof params=="undefined"&&(params=[]);for(var i=0;i<this._eventHandlers.length;i++){var s=this._eventHandlers[i];if(s.type==t){var o=e.extend({data:s.data},n,r);s.handler(o)}}},_normalizeEvents:function(e){typeof e=="string"&&(e=e.split(" "));for(var t=0;t<e.length;t++)typeof e[t]=="string"&&(e[t]=e[t].split("."));return e},_formatEvents:function(t){if(typeof t=="string"){t=t.split(",");for(var n=0;n<t.length;n++)t[n]=e.trim(t[n])}for(var n=0;n<t.length;n++)t[n]+=this._namespace;return t.join(" ")},addListener:function(t,n,r,s){var u=e(t);n=this._formatEvents(n);if(typeof r!="object"){s=r;r={}}typeof s=="function"?s=e.proxy(s,this):s=e.proxy(this,s);u.on(n,r,s);this._$listeners=this._$listeners.add(t);if(n.search(/\bactivate\b/)!=-1&&!u.data("garnish-activatable")){var a=this._namespace+"-activate";u.on("mousedown"+a,function(e){e.preventDefault()});u.on("click"+a,function(n){n.preventDefault();var r=e.inArray(n.currentTarget,u),i=e(t[r]);i.hasClass("disabled")||i.trigger("activate")});u.on("keydown"+a,function(t){var n=e.inArray(t.currentTarget,u);if(n!=-1&&t.keyCode==Garnish.SPACE_KEY){t.preventDefault();var r=e(u[n]);if(!r.hasClass("disabled")){r.addClass("active");Garnish.$doc.on("keyup"+a,function(e){u.removeClass("active");if(e.keyCode==Garnish.SPACE_KEY){e.preventDefault();r.trigger("activate")}Garnish.$doc.off("keyup"+a)})}}});u.hasClass("disabled")?u.removeAttr("tabindex"):u.attr("tabindex","0");u.data("garnish-activatable",!0)}if(n.search(/\btextchange\b/)!=-1)for(var f=0;f<u.length;f++){var l=e(u[f]);l.data("garnish-textchangeValue",l.val());if(!l.data("garnish-textchangeable")){var c=this._namespace+"-textchange",n="keypress"+c+" keyup"+c+" change"+c+" blur"+c;l.on(n,function(t){var n=e(t.currentTarget),r=n.val();if(r!=n.data("garnish-textchangeValue")){n.data("garnish-textchangeValue",r);n.trigger("textchange")}});l.data("garnish-textchangeable",!0)}}if(n.search(/\bresize\b/)!=-1)for(var f=0;f<u.length;f++)(function(t){if(t==window)return;if(!document.attachEvent&&!t.__resizeTriggers__){getComputedStyle(t).position=="static"&&(t.style.position="relative");var n=e('<div class="resize-triggers"><div class="expand-trigger"><div></div></div><div class="contract-trigger"></div></div>').prependTo(t);t.__resizeLast__={};t.__resizeTriggers__=n[0];i(t);t.addEventListener("scroll",o,!0);Garnish.$win.on("resize",function(){o.apply(t)});n.next().addClass("first")}})(u[f])},removeListener:function(t,n){n=this._formatEvents(n);e(t).off(n)},removeAllListeners:function(t){e(t).off(this._namespace)},destroy:function(){this.removeAllListeners(this._$listeners)}});if(!document.attachEvent)var n=function(){var e=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||function(e){return window.setTimeout(e,20)};return function(t){return e(t)}}(),r=function(){var e=window.cancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||window.clearTimeout;return function(t){return e(t)}}(),i=function(e){var t=e.__resizeTriggers__,n=t.firstElementChild,r=t.lastElementChild,i=n.firstElementChild;r.scrollLeft=r.scrollWidth;r.scrollTop=r.scrollHeight;i.style.width=n.offsetWidth+1+"px";i.style.height=n.offsetHeight+1+"px";n.scrollLeft=n.scrollWidth;n.scrollTop=n.scrollHeight},s=function(e){return e.offsetWidth!=e.__resizeLast__.width||e.offsetHeight!=e.__resizeLast__.height},o=function(t){var o=this;i(o);o.__resizeRAF__&&r(o.__resizeRAF__);o.__resizeRAF__=n(function(){if(s(o)){o.__resizeLast__.width=o.offsetWidth;o.__resizeLast__.height=o.offsetHeight;e(o).trigger("resize")}})};Garnish.BaseDrag=Garnish.Base.extend({$items:null,dragging:!1,mousedownX:null,mousedownY:null,mouseDistX:null,mouseDistY:null,$targetItem:null,targetItemMouseDiffX:null,targetItemMouseDiffY:null,mouseX:null,mouseY:null,lastMouseX:null,lastMouseY:null,scrollProperty:null,scrollDir:null,_:null,init:function(t,n){if(!n&&e.isPlainObject(t)){n=t;t=null}this.settings=e.extend({},Garnish.BaseDrag.defaults,n);this.$items=e();this._={};t&&this.addItems(t)},onMouseDown:function(t){if(t.which!=Garnish.PRIMARY_CLICK)return;if(this.$targetItem)return;if(t.currentTarget!=t.target&&this.settings.ignoreHandleSelector){var n=e(t.target);if(n.is(this.settings.ignoreHandleSelector)||n.closest(this.settings.ignoreHandleSelector).length)return}t.preventDefault();this.$targetItem=e(e.data(t.currentTarget,"drag-item"));this.mousedownX=this.mouseX=t.pageX;this.mousedownY=this.mouseY=t.pageY;var r=this.$targetItem.offset();this.targetItemMouseDiffX=t.pageX-r.left;this.targetItemMouseDiffY=t.pageY-r.top;this.addListener(Garnish.$doc,"mousemove","onMouseMove");this.addListener(Garnish.$doc,"mouseup","onMouseUp")},onMouseMove:function(t){if(t){t.preventDefault();this.settings.axis!=Garnish.Y_AXIS&&(this.mouseX=t.pageX);this.settings.axis!=Garnish.X_AXIS&&(this.mouseY=t.pageY)}this.mouseDistX=this.mouseX-this.mousedownX;this.mouseDistY=this.mouseY-this.mousedownY;if(!this.dragging){this.onMouseMove._mouseDist=Garnish.getDist(this.mousedownX,this.mousedownY,this.mouseX,this.mouseY);if(!(this.onMouseMove._mouseDist>=Garnish.BaseDrag.minMouseDist))return;this.startDragging()}if(t){this.onMouseMove._scrollProperty=null;if(this.settings.axis!=Garnish.X_AXIS){this.onMouseMove._winScrollTop=Garnish.$win.scrollTop();if(this.mouseY<this.onMouseMove._winScrollTop+Garnish.BaseDrag.windowScrollTargetSize){this.onMouseMove._scrollProperty="scrollTop";this.onMouseMove._scrollDir=-1}else{this.onMouseMove._winHeight=Garnish.$win.height();if(this.mouseY>this.onMouseMove._winScrollTop+this.onMouseMove._winHeight-Garnish.BaseDrag.windowScrollTargetSize){this.onMouseMove._scrollProperty="scrollTop";this.onMouseMove._scrollDir=1}}}if(!this.onMouseMove._scrollProperty&&this.settings.axis!=Garnish.Y_AXIS){this.onMouseMove._winScrollLeft=Garnish.$win.scrollLeft();if(this.mouseX<this.onMouseMove._winScrollLeft+Garnish.BaseDrag.windowScrollTargetSize){this.onMouseMove._scrollProperty="scrollLeft";this.onMouseMove._scrollDir=-1}else{this.onMouseMove._winWidth=Garnish.$win.width();if(this.mouseX>this.onMouseMove._winScrollLeft+this.onMouseMove._winWidth-Garnish.BaseDrag.windowScrollTargetSize){this.onMouseMove._scrollProperty="scrollLeft";this.onMouseMove._scrollDir=1}}}if(this.onMouseMove._scrollProperty){this.scrollProperty||(this.scrollInterval=setInterval(e.proxy(this,"scrollWindow"),20));this.scrollProperty=this.onMouseMove._scrollProperty;this.scrollDir=this.onMouseMove._scrollDir}else this.cancelWindowScroll()}this.onDrag()},scrollWindow:function(){this._.scrollPos=Garnish.$win[this.scrollProperty]();Garnish.$win[this.scrollProperty](this._.scrollPos+this.scrollDir*3);this.mouseY-=this._.scrollPos-Garnish.$win[this.scrollProperty]();this.onMouseMove()},cancelWindowScroll:function(){if(this.scrollInterval){clearInterval(this.scrollInterval);this.scrollInterval=null}this.scrollProperty=null;this.scrollDir=null},onMouseUp:function(e){this.removeAllListeners(Garnish.$doc);this.dragging&&this.stopDragging();this.$targetItem=null},startDragging:function(){switch(typeof this.settings.filter){case"function":this.$draggee=this.settings.filter();break;case"string":this.$draggee=this.$items.filter(this.settings.filter);break;default:this.$draggee=this.$targetItem}this.$draggee=e([this.$targetItem[0]].concat(this.$draggee.not(this.$targetItem[0]).toArray()));this.dragging=!0;this.onDragStart()},stopDragging:function(){this.dragging=!1;this.onDragStop();this.cancelWindowScroll()},onDragStart:function(){this.settings.onDragStart()},onDrag:function(){this.settings.onDrag()},onDragStop:function(){this.settings.onDragStop()},addItems:function(t){t=e.makeArray(t);for(var n=0;n<t.length;n++){var r=t[n];if(e.data(r,"drag")){Garnish.log("Element was added to more than one dragger");e.data(r,"drag").removeItems(r)}e.data(r,"drag",this);if(this.settings.handle){if(typeof this.settings.handle=="object")var i=e(this.settings.handle);else if(typeof this.settings.handle=="string")var i=e(r).find(this.settings.handle);else if(typeof this.settings.handle=="function")var i=e(this.settings.handle(r))}else var i=e(r);e.data(r,"drag-handle",i);i.data("drag-item",r);this.addListener(i,"mousedown","onMouseDown")}this.$items=e().add(this.$items.add(t))},removeItems:function(t){t=e.makeArray(t);for(var n=0;n<t.length;n++){var r=t[n],i=e.inArray(r,this.$items);if(i!=-1){var s=e.data(r,"drag-handle");s.data("drag-item",null);e.data(r,"drag",null);e.data(r,"drag-handle",null);this.removeAllListeners(s);this.$items.splice(i,1)}}},removeAllItems:function(){for(var t=0;t<this.$items.length;t++){var n=this.$items[t],r=e.data(n,"drag-handle");e.data(n,"drag",null);if(r){e.data(n,"drag-handle",null);r.data("drag-item",null);this.removeAllListeners(r)}}this.$items=e()}},{minMouseDist:1,windowScrollTargetSize:20,defaults:{handle:null,filter:null,axis:null,ignoreHandleSelector:"input, textarea, button, select, .btn",onDragStart:e.noop,onDrag:e.noop,onDragStop:e.noop}});Garnish.CheckboxSelect=Garnish.Base.extend({$container:null,$all:null,$options:null,init:function(t){this.$container=e(t);if(this.$container.data("checkboxSelect")){Garnish.log("Double-instantiating a checkbox select on an element");this.$container.data("checkbox-select").destroy()}this.$container.data("checkboxSelect",this);var n=this.$container.find("input");this.$all=n.filter(".all:first");this.$options=n.not(this.$all);this.addListener(this.$all,"change","onAllChange")},onAllChange:function(){var e=this.$all.prop("checked");this.$options.prop({checked:e,disabled:e})}});Garnish.ContextMenu=Garnish.Base.extend({$target:null,options:null,$menu:null,showingMenu:!1,init:function(t,n,r){this.$target=e(t);if(this.$target.data("contextmenu")){Garnish.log("Double-instantiating a context menu on an element");this.$target.data("contextmenu").destroy()}this.$target.data("contextmenu",this);this.options=n;this.setSettings(r,Garnish.ContextMenu.defaults);Garnish.ContextMenu.counter++;this.enable()},buildMenu:function(){this.$menu=e('<div class="'+this.settings.menuClass+'" style="display: none" />');var t=e("<ul/>").appendTo(this.$menu);for(var n in this.options){var r=this.options[n];if(r=="-")t=e("<ul/>").appendTo(this.$menu);else{var i=e("<li></li>").appendTo(t),s=e("<a>"+r.label+"</a>").appendTo(i);typeof r.onClick=="function"&&function(t,n){setTimeout(e.proxy(function(){t.mousedown(e.proxy(function(t){this.hideMenu();n.call(this.currentTarget,e.extend(t,{currentTarget:this.currentTarget}))},this))},this),1)}.call(this,s,r.onClick)}}},showMenu:function(t){if(t.type=="mousedown"&&t.which!=Garnish.SECONDARY_CLICK)return;t.type=="contextmenu"&&t.preventDefault();if(this.showing&&t.currentTarget==this.currentTarget)return;this.currentTarget=t.currentTarget;this.$menu||this.buildMenu();this.$menu.appendTo(document.body);this.$menu.show();this.$menu.css({left:t.pageX+1,top:t.pageY-4});this.showing=!0;setTimeout(e.proxy(function(){this.addListener(Garnish.$doc,"mousedown","hideMenu")},this),0)},hideMenu:function(){this.removeListener(Garnish.$doc,"mousedown");this.$menu.hide();this.showing=!1},enable:function(){this.addListener(this.$target,"contextmenu,mousedown","showMenu")},disable:function(){this.removeListener(this.$target,"contextmenu,mousedown")}},{defaults:{menuClass:"menu"},counter:0});Garnish.Drag=Garnish.BaseDrag.extend({$draggee:null,otherItems:null,totalOtherItems:null,helpers:null,helperTargets:null,helperPositions:null,helperLagIncrement:null,updateHelperPosInterval:null,draggeeMouseOffsetX:null,draggeeMouseOffsetY:null,init:function(t,n){if(!n&&e.isPlainObject(t)){n=t;t=null}n=e.extend({},Garnish.Drag.defaults,n);this.base(t,n)},onDragStart:function(){this.helpers=[];this.helperTargets=[];this.helperPositions=[];this.draggeeDisplay=this.$draggee.css("display");this.createHelpers();this.settings.removeDraggee?this.$draggee.hide():this.$draggee.css("visibility","hidden");this.lastMouseX=this.lastMouseY=null;this.otherItems=[];for(var t=0;t<this.$items.length;t++){var n=this.$items[t];e.inArray(n,this.$draggee)==-1&&this.otherItems.push(n)}this.totalOtherItems=this.otherItems.length;this.helperLagIncrement=this.helpers.length==1?0:Garnish.Drag.helperLagIncrementDividend/(this.helpers.length-1);this.updateHelperPosInterval=setInterval(e.proxy(this,"updateHelperPos"),Garnish.Drag.updateHelperPosInterval);var r=this.$draggee.offset();this.draggeeMouseOffsetX=this.mouseX-(r.left+this.$draggee.outerWidth()/2);this.draggeeMouseOffsetY=this.mouseY-(r.top+this.$draggee.outerHeight()/2);this.base()},onDragStop:function(){clearInterval(this.updateHelperPosInterval);this.base()},createHelpers:function(){for(var t=0;t<this.$draggee.length;t++){var n=e(this.$draggee[t]),r=n.clone().addClass("draghelper");r.css({width:n.width(),height:n.height(),margin:0});this.settings.helper&&(typeof this.settings.helper=="function"?r=this.settings.helper(r):r=e(this.settings.helper).append(r));r.appendTo(Garnish.$bod);var i=this.getHelperTarget(t);r.css({position:"absolute",top:i.top,left:i.left,zIndex:Garnish.Drag.helperZindex+this.$draggee.length-t,opacity:this.settings.helperOpacity});this.helperPositions[t]={top:i.top,left:i.left};this.helpers.push(r)}},getHelperTarget:function(e){return{left:this.mouseX-this.targetItemMouseDiffX+e*Garnish.Drag.helperSpacingX,top:this.mouseY-this.targetItemMouseDiffY+e*Garnish.Drag.helperSpacingY}},updateHelperPos:function(){if(this.mouseX!==this.lastMouseX||this.mouseY!==this.lastMouseY){for(this.updateHelperPos._i=0;this.updateHelperPos._i<this.helpers.length;this.updateHelperPos._i++)this.helperTargets[this.updateHelperPos._i]=this.getHelperTarget(this.updateHelperPos._i);this.lastMouseX=this.mouseX;this.lastMouseY=this.mouseY}for(this.updateHelperPos._j=0;this.updateHelperPos._j<this.helpers.length;this.updateHelperPos._j++){this.updateHelperPos._lag=Garnish.Drag.helperLagBase+this.helperLagIncrement*this.updateHelperPos._j;this.helperPositions[this.updateHelperPos._j]={left:this.helperPositions[this.updateHelperPos._j].left+(this.helperTargets[this.updateHelperPos._j].left-this.helperPositions[this.updateHelperPos._j].left)/this.updateHelperPos._lag,top:this.helperPositions[this.updateHelperPos._j].top+(this.helperTargets[this.updateHelperPos._j].top-this.helperPositions[this.updateHelperPos._j].top)/this.updateHelperPos._lag};this.helpers[this.updateHelperPos._j].css(this.helperPositions[this.updateHelperPos._j])}},returnHelpersToDraggees:function(){for(var t=0;t<this.$draggee.length;t++){var n=e(this.$draggee[t]),r=this.helpers[t],i=n.offset();(function(e,t){t.animate({left:i.left,top:i.top},"fast",function(){e.css("visibility","inherit");t.remove()})})(n,r)}}},{helperZindex:1e3,helperLagBase:1,helperLagIncrementDividend:1.5,updateHelperPosInterval:20,helperSpacingX:5,helperSpacingY:5,defaults:{removeDraggee:!1,helperOpacity:1,helper:null}});Garnish.DragDrop=Garnish.Drag.extend({$dropTargets:null,$activeDropTarget:null,init:function(t){t=e.extend({},Garnish.DragDrop.defaults,t);this.base(t)},onDragStart:function(){if(this.settings.dropTargets){typeof this.settings.dropTargets=="function"?this.$dropTargets=e(this.settings.dropTargets()):this.$dropTargets=e(this.settings.dropTargets);this.$dropTargets.length||(this.$dropTargets=null)}this.$activeDropTarget=null;this.base()},onDrag:function(){if(this.$dropTargets){this.onDrag._activeDropTarget=null;for(this.onDrag._i=0;this.onDrag._i<this.$dropTargets.length;this.onDrag._i++){this.onDrag._elem=this.$dropTargets[this.onDrag._i];if(Garnish.hitTest(this.mouseX,this.mouseY,this.onDrag._elem)){this.onDrag._activeDropTarget=this.onDrag._elem;break}}if(this.$activeDropTarget&&this.onDrag._activeDropTarget!=this.$activeDropTarget[0]||!this.$activeDropTarget&&this.onDrag._activeDropTarget!==null){this.$activeDropTarget&&this.$activeDropTarget.removeClass(this.settings.activeDropTargetClass);this.onDrag._activeDropTarget?this.$activeDropTarget=e(this.onDrag._activeDropTarget).addClass(this.settings.activeDropTargetClass):this.$activeDropTarget=null;this.settings.onDropTargetChange(this.$activeDropTarget)}}this.base()},onDragStop:function(){this.$dropTargets&&this.$activeDropTarget&&this.$activeDropTarget.removeClass(this.settings.activeDropTargetClass);this.base()},fadeOutHelpers:function(){for(var e=0;e<this.helpers.length;e++)(function(e){e.fadeOut("fast",function(){e.remove()})})(this.helpers[e])}},{defaults:{dropTargets:null,onDropTargetChange:e.noop,activeDropTargetClass:"active"}});Garnish.DragMove=Garnish.BaseDrag.extend({onDrag:function(e,t){this.$targetItem.css({left:this.mouseX-this.targetItemMouseDiffX,top:this.mouseY-this.targetItemMouseDiffY})}});Garnish.DragSort=Garnish.Drag.extend({$heightedContainer:null,$insertion:null,$caboose:null,startDraggeeIndex:null,closestItem:null,draggeeMidpointX:null,draggeeMidpointY:null,init:function(t,n){if(!n&&e.isPlainObject(t)){n=t;t=null}n=e.extend({},Garnish.DragSort.defaults,n);this.base(t,n);this.settings.caboose&&(typeof this.settings.caboose=="function"?this.$caboose=e(this.settings.caboose()):this.$caboose=e(this.settings.caboose))},onDragStart:function(){this.base();if(this.$caboose){var t=e().add(this.$items).last();this.$caboose.insertAfter(t);this.otherItems.push(this.$caboose[0]);this.totalOtherItems++}this.closestItem=null;this.setMidpoints();this.setInsertion();if(this.settings.container){this.$heightedContainer=e(this.settings.container);while(!this.$heightedContainer.height())this.$heightedContainer=this.$heightedContainer.parent()}this.startDraggeeIndex=e.inArray(this.$draggee[0],this.$items)},setInsertion:function(){this.settings.insertion&&(typeof this.settings.insertion=="function"?this.$insertion=e(this.settings.insertion(this.$draggee)):this.$insertion=e(this.settings.insertion))},setMidpoints:function(){for(var e=0;e<this.$items.length;e++)this.setMidpoint(this.$items[e]);this.setMidpoint(this.$caboose)},setMidpoint:function(t){var n=e(t),r=n.offset();n.data("midpoint",{left:r.left+n.outerWidth()/2,top:r.top+n.outerHeight()/2})},onDrag:function(){this.draggeeMidpointX=this.mouseX-this.draggeeMouseOffsetX;this.draggeeMidpointY=this.mouseY-this.draggeeMouseOffsetY;if(this.$heightedContainer&&!Garnish.hitTest(this.mouseX,this.mouseY,this.$heightedContainer)){if(this.closestItem){this.closestItem=null;this.$insertion&&this.$insertion.remove()}}else this.closestItem!=(this.closestItem=this.getClosestItem())&&this.closestItem!=this.$draggee[0]&&this.onInsertionPointChange();this.base()},getClosestItem:function(){this.getClosestItem._closestItem=this.$draggee[0];this.getClosestItem._midpoint=this.$draggee.data("midpoint");this.getClosestItem._closestItemMouseDiff=Garnish.getDist(this.getClosestItem._midpoint.left,this.getClosestItem._midpoint.top,this.draggeeMidpointX,this.draggeeMidpointY);for(this.getClosestItem._i=0;this.getClosestItem._i<this.totalOtherItems;this.getClosestItem._i++)this.testForClosestItem(this.otherItems[this.getClosestItem._i]);return this.getClosestItem._closestItem},testForClosestItem:function(t){this.getClosestItem._$item=e(t);this.getClosestItem._midpoint=this.getClosestItem._$item.data("midpoint");if(this.getClosestItem._midpoint.top>=this.draggeeMidpointY||this.getClosestItem._midpoint.left>=this.draggeeMidpointX){this.getClosestItem._mouseDiff=Garnish.getDist(this.getClosestItem._midpoint.left,this.getClosestItem._midpoint.top,this.draggeeMidpointX,this.draggeeMidpointY);if(this.getClosestItem._mouseDiff<this.getClosestItem._closestItemMouseDiff){this.getClosestItem._closestItem=this.getClosestItem._$item[0];this.getClosestItem._closestItemMouseDiff=this.getClosestItem._mouseDiff}}},onInsertionPointChange:function(){if(this.closestItem){this.$draggee.insertBefore(this.closestItem);this.$insertion&&this.$insertion.insertBefore(this.closestItem)}this.setMidpoints();this.settings.onInsertionPointChange()},onDragStop:function(){this.$caboose&&this.$caboose.remove();this.$insertion&&this.$insertion.remove();this.$draggee.css({display:this.draggeeDisplay,visibility:"hidden"});this.returnHelpersToDraggees();this.base();this.$items=e().add(this.$items);var t=e.inArray(this.$draggee[0],this.$items);this.startDraggeeIndex!=t&&this.settings.onSortChange()}},{defaults:{container:null,insertion:null,onInsertionPointChange:e.noop,onSortChange:e.noop}});Garnish.EscManager=Garnish.Base.extend({handlers:null,init:function(){this.handlers=[];this.addListener(Garnish.$bod,"keyup",function(e){e.keyCode==Garnish.ESC_KEY&&this.escapeLatest(e)})},register:function(e,t){this.handlers.push({obj:e,func:t})},unregister:function(e){for(var t=this.handlers.length-1;t>=0;t--)this.handlers[t].obj==e&&this.handlers.splice(t,1)},escapeLatest:function(e){if(this.handlers.length){var t=this.handlers.pop();if(typeof t.func=="function")var n=t.func;else var n=t.obj[t.func];n.call(t.obj,e)}}});Garnish.escManager=new Garnish.EscManager;Garnish.HUD=Garnish.Base.extend({$trigger:null,$hud:null,$tip:null,$body:null,$shade:null,windowWidth:null,windowHeight:null,windowScrollLeft:null,windowScrollTop:null,triggerWidth:null,triggerHeight:null,triggerOffset:null,width:null,height:null,showing:!1,position:null,init:function(t,n,r){this.$trigger=e(t);this.setSettings(r,Garnish.HUD.defaults);this.on("show",this.settings.onShow);this.on("hide",this.settings.onHide);typeof Garnish.HUD.activeHUDs=="undefined"&&(Garnish.HUD.activeHUDs={});this.$shade=e('<div class="hud-shade"/>');this.$hud=e('<div class="'+this.settings.hudClass+'" />');this.$tip=e('<div class="'+this.settings.tipClass+'" />').appendTo(this.$hud);this.$body=e('<div class="'+this.settings.bodyClass+'" />').appendTo(this.$hud).append(n);this.$body.find(".footer").length&&this.$hud.addClass("has-footer");this.show()},show:function(e){e&&e.stopPropagation&&e.stopPropagation();if(this.showing)return;if(this.settings.closeOtherHUDs)for(var t in Garnish.HUD.activeHUDs)Garnish.HUD.activeHUDs[t].hide();this.$hud.css("top",Garnish.$win.scrollTop());this.$shade.appendTo(Garnish.$bod);this.$hud.appendTo(Garnish.$bod);this.$hud.show();this.determineBestPosition();this.setPosition();this.$shade.show();this.showing=!0;Garnish.HUD.activeHUDs[this._namespace]=this;Garnish.escManager.register(this,"hide");this.addListener(this.$hud,"resize","resetPosition");this.addListener(Garnish.$win,"resize","resetPosition");this.addListener(this.$shade,"click","hide");this.settings.closeBtn&&this.addListener(this.settings.closeBtn,"activate","hide");this.onShow()},onShow:function(){this.trigger("show")},updateElementProperties:function(){this.windowWidth=Garnish.$win.width();this.windowHeight=Garnish.$win.height();this.windowScrollLeft=Garnish.$win.scrollLeft();this.windowScrollTop=Garnish.$win.scrollTop();this.triggerWidth=this.$trigger.outerWidth();this.triggerHeight=this.$trigger.outerHeight();this.triggerOffset=this.$trigger.offset();this.triggerOffset.right=this.triggerOffset.left+this.triggerWidth;this.triggerOffset.bottom=this.triggerOffset.top+this.triggerHeight;this.width=this.$hud.outerWidth();this.height=this.$hud.outerHeight()},determineBestPosition:function(){this.updateElementProperties();this.minHorizontalClearance=this.width+this.settings.triggerSpacing+this.settings.windowSpacing;this.minVerticalClearance=this.height+this.settings.triggerSpacing+this.settings.windowSpacing;var t=[this.windowHeight+this.windowScrollTop-this.triggerOffset.bottom,this.triggerOffset.top-this.windowScrollTop,this.windowWidth+this.windowScrollLeft-this.triggerOffset.right,this.triggerOffset.left-this.windowScrollLeft];for(var n=0;n<4;n++){var r=n<2?"height":"width";if(t[n]-(this.settings.windowSpacing+this.settings.triggerSpacing)>=this[r]){var i=n;break}}if(typeof i=="undefined")var s=Math.max.apply(null,t),i=e.inArray(s,t);this.position=Garnish.HUD.positions[i];this.tipClass&&this.$tip.removeClass(this.tipClass);this.tipClass=this.settings.tipClass+"-"+Garnish.HUD.tipClasses[i];this.$tip.addClass(this.tipClass)},setPosition:function(){if(this.position=="top"||this.position=="bottom"){var e=this.windowWidth+this.windowScrollLeft-(this.width+this.settings.windowSpacing
),t=this.windowScrollLeft+this.settings.windowSpacing,n=this.triggerOffset.left+Math.round(this.triggerWidth/2),r=n-Math.round(this.width/2);r>e&&(r=e);r<t&&(r=t);this.$hud.css("left",r);var i=n-r-this.settings.tipWidth/2;this.$tip.css({left:i,top:""});if(this.position=="top"){var s=this.triggerOffset.top-(this.height+this.settings.triggerSpacing);this.$hud.css("top",s)}else{var s=this.triggerOffset.bottom+this.settings.triggerSpacing;this.$hud.css("top",s)}}else{var o=this.windowHeight+this.windowScrollTop-(this.height+this.settings.windowSpacing),u=this.windowScrollTop+this.settings.windowSpacing,n=this.triggerOffset.top+Math.round(this.triggerHeight/2),s=n-Math.round(this.height/2);s>o&&(s=o);s<u&&(s=u);this.$hud.css("top",s);var a=n-s-this.settings.tipWidth/2;this.$tip.css({top:a,left:""});if(this.position=="left"){var r=this.triggerOffset.left-(this.width+this.settings.triggerSpacing);this.$hud.css("left",r)}else{var r=this.triggerOffset.right+this.settings.triggerSpacing;this.$hud.css("left",r)}}},resetPosition:function(){this.updateElementProperties();this.setPosition()},hide:function(){this.$hud.hide();this.$shade.hide();this.showing=!1;delete Garnish.HUD.activeHUDs[this._namespace];Garnish.escManager.unregister(this);this.onHide()},onHide:function(){this.trigger("hide")},toggle:function(){this.showing?this.hide():this.show()}},{positions:["bottom","top","right","left"],tipClasses:["top","bottom","left","right"],defaults:{hudClass:"hud",tipClass:"tip",bodyClass:"body",triggerSpacing:10,windowSpacing:10,tipWidth:30,onShow:e.noop,onHide:e.noop,closeBtn:null,closeOtherHUDs:!0}});Garnish.LightSwitch=Garnish.Base.extend({settings:null,$outerContainer:null,$innerContainer:null,$input:null,$toggleTarget:null,on:null,dragger:null,dragStartMargin:null,init:function(t,n){this.$outerContainer=e(t);if(this.$outerContainer.data("lightswitch")){Garnish.log("Double-instantiating a switch on an element");this.$outerContainer.data("lightswitch").destroy()}this.$outerContainer.data("lightswitch",this);this.setSettings(n,Garnish.LightSwitch.defaults);this.$innerContainer=this.$outerContainer.find(".container:first");this.$input=this.$outerContainer.find("input:first");this.$toggleTarget=e(this.$outerContainer.attr("data-toggle"));this.on=this.$outerContainer.hasClass("on");this.addListener(this.$outerContainer,"mousedown","_onMouseDown");this.addListener(this.$outerContainer,"keydown","_onKeyDown");this.dragger=new Garnish.BaseDrag(this.$outerContainer,{axis:Garnish.X_AXIS,ignoreHandleSelector:null,onDragStart:e.proxy(this,"_onDragStart"),onDrag:e.proxy(this,"_onDrag"),onDragStop:e.proxy(this,"_onDragStop")})},turnOn:function(){this.$innerContainer.stop().animate({marginLeft:0},"fast");this.$input.val(Garnish.Y_AXIS);this.on=!0;this.settings.onChange();this.$toggleTarget.show();this.$toggleTarget.height("auto");var t=this.$toggleTarget.height();this.$toggleTarget.height(0);this.$toggleTarget.stop().animate({height:t},"fast",e.proxy(function(){this.$toggleTarget.height("auto")},this))},turnOff:function(){this.$innerContainer.stop().animate({marginLeft:Garnish.LightSwitch.offMargin},"fast");this.$input.val("");this.on=!1;this.settings.onChange();this.$toggleTarget.stop().animate({height:0},"fast")},toggle:function(e){this.on?this.turnOff():this.turnOn()},_onMouseDown:function(){this.addListener(Garnish.$doc,"mouseup","_onMouseUp")},_onMouseUp:function(){this.removeListener(Garnish.$doc,"mouseup");this.dragger.dragging||this.toggle()},_onKeyDown:function(e){switch(e.keyCode){case Garnish.SPACE_KEY:this.toggle();e.preventDefault();break;case Garnish.RIGHT_KEY:Garnish.ltr?this.turnOn():this.turnOff();e.preventDefault();break;case Garnish.LEFT_KEY:Garnish.ltr?this.turnOff():this.turnOn();e.preventDefault()}},_getMargin:function(){return parseInt(this.$innerContainer.css("marginLeft"))},_onDragStart:function(){this.dragStartMargin=this._getMargin()},_onDrag:function(){var e=this.dragStartMargin+this.dragger.mouseDistX;e<Garnish.LightSwitch.offMargin?e=Garnish.LightSwitch.offMargin:e>0&&(e=0);this.$innerContainer.css("marginLeft",e)},_onDragStop:function(){var e=this._getMargin();e>-16?this.turnOn():this.turnOff()},destroy:function(){this.base();this.dragger.destroy()}},{offMargin:-50,defaults:{onChange:e.noop}});Garnish.Menu=Garnish.Base.extend({settings:null,$container:null,$options:null,$trigger:null,init:function(t,n){this.setSettings(n,Garnish.Menu.defaults);this.$container=e(t);this.$options=this.$container.find("a");this.$options.data("menu",this);this.settings.attachToElement&&(this.$trigger=e(this.settings.attachToElement));this.addListener(this.$container,"mousedown",function(e){e.stopPropagation()});this.addListener(this.$options,"click","selectOption")},setPositionRelativeToTrigger:function(){var e=Garnish.$win.height(),t=Garnish.$win.scrollTop(),n=this.$trigger.offset(),r=this.$trigger.outerWidth(),i=this.$trigger.outerHeight(),s=n.top+i,o=n.top,u=this.$container.outerHeight(),a=e+t-s,f=o-t,l={minWidth:r-(this.$container.outerWidth()-this.$container.width())};a>=u||a>=f?l.top=s:l.top=o-u;var c=this.$container.data("align");c||(c="left");Garnish.rtl&&(c=="left"?c="right":c=="right"&&(c="left"));switch(c){case"right":l.right=Garnish.$win.width()-(n.left+r);break;case"center":l.left=Math.round(n.left+r/2-this.$container.outerWidth()/2);break;case"left":l.left=n.left}this.$container.css(l)},show:function(){this.$container.appendTo(Garnish.$bod);this.$trigger&&this.setPositionRelativeToTrigger();this.$container.fadeIn(50);Garnish.escManager.register(this,"hide")},hide:function(){this.$container.fadeOut("fast");Garnish.escManager.unregister(this);this.trigger("hide")},selectOption:function(e){this.settings.onOptionSelect(e.currentTarget);this.trigger("optionselect",{selectedOption:e.currentTarget});this.hide()}},{defaults:{attachToElement:null,onOptionSelect:e.noop}});Garnish.MenuBtn=Garnish.Base.extend({$btn:null,menu:null,showingMenu:!1,init:function(t,n){this.$btn=e(t);if(this.$btn.data("menubtn")){Garnish.log("Double-instantiating a menu button on an element");this.$btn.data("menubtn").destroy()}this.$btn.data("menubtn",this);this.setSettings(n,Garnish.MenuBtn.defaults);var r=this.$btn.next(".menu").detach();this.menu=new Garnish.Menu(r,{attachToElement:this.$btn,onOptionSelect:e.proxy(this,"onOptionSelect")});this.menu.on("hide",e.proxy(this,"onMenuHide"));this.addListener(this.$btn,"mousedown","onMouseDown")},onMouseDown:function(e){if(e.which!=Garnish.PRIMARY_CLICK||e.metaKey)return;e.preventDefault();this.showingMenu?this.hideMenu():this.showMenu()},showMenu:function(){this.menu.show();this.$btn.addClass("active");this.showingMenu=!0;setTimeout(e.proxy(function(){this.addListener(Garnish.$doc,"mousedown","onMouseDown")},this),1);Garnish.isMobileBrowser()||this.addListener(Garnish.$win,"resize","hideMenu")},hideMenu:function(){this.menu.hide()},onMenuHide:function(){this.$btn.removeClass("active");this.showingMenu=!1;this.removeListener(Garnish.$doc,"mousedown");Garnish.isMobileBrowser()||this.removeListener(Garnish.$doc,"resize")},onOptionSelect:function(e){this.settings.onOptionSelect(e)}},{defaults:{onOptionSelect:e.noop}});Garnish.MixedInput=Garnish.Base.extend({$container:null,elements:null,focussedElement:null,blurTimeout:null,init:function(t,n){this.$container=e(t);this.setSettings(n,Garnish.MixedInput.defaults);this.elements=[];this.$container.attr("tabindex",0);this.addListener(this.$container,"focus","onFocus")},getElementIndex:function(t){return e.inArray(t,this.elements)},isText:function(e){return e.prop("nodeName")=="INPUT"},onFocus:function(e){if(this.elements.length){var t=this.elements[0];this.setFocus(t);this.setCarotPos(t,0)}else this.addTextElement()},addTextElement:function(e){var t=new u(this);this.addElement(t.$input,e);return t},addElement:function(t,n){if(typeof n=="undefined")if(this.focussedElement){var r=this.focussedElement,i=this.getElementIndex(r);if(this.isText(r)){var s=r.prop("selectionStart"),o=r.prop("selectionEnd"),a=r.val(),f=a.substring(0,s),l=a.substr(o);if(f&&l){r.val(f).trigger("change");var c=new u(this);c.$input.val(l).trigger("change");this.addElement(c.$input,i+1);n=i+1}else f?n=i+1:n=i}else n=i+1}else n=this.elements.length;if(typeof this.elements[n]!="undefined"){t.insertBefore(this.elements[n]);this.elements.splice(n,0,t)}else{n=this.elements.length;this.$container.append(t);this.elements.push(t)}if(!this.isText(t)){if(n==0||!this.isText(this.elements[n-1])){this.addTextElement(n);n++}(n==this.elements.length-1||!this.isText(this.elements[n+1]))&&this.addTextElement(n+1)}this.addListener(t,"click",function(){this.setFocus(t)});setTimeout(e.proxy(function(){this.setFocus(t)},this),1)},removeElement:function(e){var t=this.getElementIndex(e);if(t!=-1){this.elements.splice(t,1);if(!this.isText(e)){var n=this.elements[t-1],r=this.elements[t];if(this.isText(n)&&this.isText(r)){var i=n.val(),s=i+r.val();n.val(s).trigger("change");this.removeElement(r);this.setFocus(n);this.setCarotPos(n,i.length)}}e.remove()}},setFocus:function(t){this.$container.addClass("focus");this.focussedElement?this.blurFocussedElement():this.$container.attr("tabindex","-1");t.attr("tabindex","0");t.focus();this.focussedElement=t;this.addListener(t,"blur",function(){this.blurTimeout=setTimeout(e.proxy(function(){if(this.focussedElement==t){this.blurFocussedElement();this.focussedElement=null;this.$container.removeClass("focus");this.$container.attr("tabindex","0")}},this),1)})},blurFocussedElement:function(){this.removeListener(this.focussedElement,"blur");this.focussedElement.attr("tabindex","-1")},focusPreviousElement:function(e){var t=this.getElementIndex(e);if(t>0){var n=this.elements[t-1];this.setFocus(n);if(this.isText(n)){var r=n.val().length;this.setCarotPos(n,r)}}},focusNextElement:function(e){var t=this.getElementIndex(e);if(t<this.elements.length-1){var n=this.elements[t+1];this.setFocus(n);this.isText(n)&&this.setCarotPos(n,0)}},setCarotPos:function(e,t){e.prop("selectionStart",t);e.prop("selectionEnd",t)}});var u=Garnish.Base.extend({parentInput:null,$input:null,$stage:null,val:null,focussed:!1,interval:null,init:function(t){this.parentInput=t;this.$input=e('<input type="text"/>').appendTo(this.parentInput.$container);this.$input.css("margin-right",2-u.padding+"px");this.setWidth();this.addListener(this.$input,"focus","onFocus");this.addListener(this.$input,"blur","onBlur");this.addListener(this.$input,"keydown","onKeyDown");this.addListener(this.$input,"change","checkInput")},getIndex:function(){return this.parentInput.getElementIndex(this.$input)},buildStage:function(){this.$stage=e("<stage/>").appendTo(Garnish.$bod);this.$stage.css({position:"absolute",top:-9999,left:-9999,wordWrap:"nowrap"});Garnish.copyTextStyles(this.$input,this.$stage)},getTextWidth:function(e){this.$stage||this.buildStage();if(e){e=e.replace(/&/g,"&amp;");e=e.replace(/</g,"&lt;");e=e.replace(/>/g,"&gt;");e=e.replace(/ /g,"&nbsp;")}this.$stage.html(e);this.stageWidth=this.$stage.width();return this.stageWidth},onFocus:function(){this.focussed=!0;this.interval=setInterval(e.proxy(this,"checkInput"),Garnish.NiceText.interval);this.checkInput()},onBlur:function(){this.focussed=!1;clearInterval(this.interval);this.checkInput()},onKeyDown:function(t){setTimeout(e.proxy(this,"checkInput"),1);switch(t.keyCode){case Garnish.LEFT_KEY:this.$input.prop("selectionStart")==0&&this.$input.prop("selectionEnd")==0&&this.parentInput.focusPreviousElement(this.$input);break;case Garnish.RIGHT_KEY:this.$input.prop("selectionStart")==this.val.length&&this.$input.prop("selectionEnd")==this.val.length&&this.parentInput.focusNextElement(this.$input);break;case Garnish.DELETE_KEY:if(this.$input.prop("selectionStart")==0&&this.$input.prop("selectionEnd")==0){this.parentInput.focusPreviousElement(this.$input);t.preventDefault()}}},getVal:function(){this.val=this.$input.val();return this.val},setVal:function(e){this.$input.val(e);this.checkInput()},checkInput:function(){var e=this.val!==this.getVal();if(e){this.setWidth();this.onChange()}return e},setWidth:function(){if(this.stageWidth!==this.getTextWidth(this.val)){var e=this.stageWidth+u.padding;this.$input.width(e)}},onChange:e.noop},{padding:20});Garnish.Modal=Garnish.Base.extend({$container:null,$shade:null,visible:!1,dragger:null,desiredWidth:null,desiredHeight:null,resizeDragger:null,resizeStartWidth:null,resizeStartHeight:null,init:function(t,n){if(!n&&e.isPlainObject(t)){n=t;t=null}this.setSettings(n,Garnish.Modal.defaults);t?this.$shade=e('<div class="modal-shade"/>').insertBefore(t):this.$shade=e('<div class="modal-shade"/>').appendTo(Garnish.$bod);if(t){this.setContainer(t);this.show()}Garnish.Modal.instances.push(this)},setContainer:function(t){this.$container=e(t);if(this.$container.data("modal")){Garnish.log("Double-instantiating a modal on an element");this.$container.data("modal").destroy()}this.$container.data("modal",this);this.settings.draggable&&(this.dragger=new Garnish.DragMove(this.$container,{handle:this.settings.dragHandleSelector?this.$container.find(this.settings.dragHandleSelector):this.$container}));if(this.settings.resizable){var n=e('<div class="resizehandle"/>').appendTo(this.$container);this.resizeDragger=new Garnish.BaseDrag(n,{onDragStart:e.proxy(this,"_onResizeStart"),onDrag:e.proxy(this,"_onResize")})}this.addListener(this.$container,"click",function(e){e.stopPropagation()});this.visible&&this.show()},show:function(){this.settings.closeOtherModals&&Garnish.Modal.visibleModal&&Garnish.Modal.visibleModal!=this&&Garnish.Modal.visibleModal.hide();if(this.$container){this.$shade.appendTo(Garnish.$bod);this.$container.appendTo(Garnish.$bod);this.$container.show();this.updateSizeAndPosition();this.$shade.fadeIn(50);this.$container.delay(50).fadeIn(e.proxy(this,"onFadeIn"));this.addListener(this.$shade,"click","hide");this.addListener(Garnish.$win,"resize","updateSizeAndPosition")}Garnish.escManager.register(this,"hide");if(!this.visible){this.visible=!0;Garnish.Modal.visibleModal=this;this.settings.onShow()}},hide:function(t){t&&t.stopPropagation();if(this.$container){this.$container.fadeOut("fast");this.$shade.fadeOut("fast",e.proxy(this,"onFadeOut"));this.removeListener(this.$shade,"click");this.removeListener(Garnish.$win,"resize")}this.visible=!1;Garnish.Modal.visibleModal=null;Garnish.escManager.unregister(this);this.settings.onHide()},updateSizeAndPosition:function(){if(!this.$container)return;this.$container.css({width:this.desiredWidth?Math.max(this.desiredWidth,200):"",height:this.desiredHeight?Math.max(this.desiredHeight,200):"","min-width":"","min-height":""});this.updateSizeAndPosition._windowWidth=Garnish.$win.width();this.updateSizeAndPosition._width=Math.min(this.getWidth(),this.updateSizeAndPosition._windowWidth-20);this.$container.css({width:this.updateSizeAndPosition._width,"min-width":this.updateSizeAndPosition._width,left:Math.round((this.updateSizeAndPosition._windowWidth-this.updateSizeAndPosition._width)/2)});this.updateSizeAndPosition._windowHeight=Garnish.$win.height();this.updateSizeAndPosition._height=Math.min(this.getHeight(),this.updateSizeAndPosition._windowHeight-20);this.$container.css({height:this.updateSizeAndPosition._height,"min-height":this.updateSizeAndPosition._height,top:Math.round((this.updateSizeAndPosition._windowHeight-this.updateSizeAndPosition._height)/2)})},onFadeIn:function(){this.settings.onFadeIn()},onFadeOut:function(){this.settings.onFadeOut()},getHeight:function(){if(!this.$container)throw"Attempted to get the height of a modal whose container has not been set.";this.visible||this.$container.show();this.getHeight._height=this.$container.outerHeight();this.visible||this.$container.hide();return this.getHeight._height},getWidth:function(){if(!this.$container)throw"Attempted to get the width of a modal whose container has not been set.";this.visible||this.$container.show();this.getWidth._width=this.$container.outerWidth();this.visible||this.$container.hide();return this.getWidth._width},_onResizeStart:function(){this.resizeStartWidth=this.getWidth();this.resizeStartHeight=this.getHeight()},_onResize:function(){Garnish.ltr?this.desiredWidth=this.resizeStartWidth+this.resizeDragger.mouseDistX*2:this.desiredWidth=this.resizeStartWidth-this.resizeDragger.mouseDistX*2;this.desiredHeight=this.resizeStartHeight+this.resizeDragger.mouseDistY*2;this.updateSizeAndPosition()},destroy:function(){this.base();this.dragger&&this.dragger.destroy();this.resizeDragger&&this.resizeDragger.destroy()}},{relativeElemPadding:8,defaults:{draggable:!1,dragHandleSelector:null,resizable:!1,onShow:e.noop,onHide:e.noop,onFadeIn:e.noop,onFadeOut:e.noop,closeOtherModals:!0},instances:[],visibleModal:null});Garnish.NiceText=Garnish.Base.extend({$input:null,$hint:null,$stage:null,autoHeight:null,focussed:!1,showingHint:!1,val:null,inputBoxSizing:"content-box",height:null,minHeight:null,interval:null,initialized:!1,init:function(t,n){this.$input=e(t);this.settings=e.extend({},Garnish.NiceText.defaults,n);if(this.$input.data("nicetext")){Garnish.log("Double-instantiating a transparent text input on an element");this.$input.data("nicetext").destroy()}this.$input.data("nicetext",this);this.getVal();this.autoHeight=this.settings.autoHeight&&this.$input.prop("nodeName")=="TEXTAREA";if(this.autoHeight){this.minHeight=this.getHeightForValue("");this.updateHeight();this.addListener(Garnish.$win,"resize","updateHeight")}if(this.settings.hint){this.$hintContainer=e('<div class="texthint-container"/>').insertBefore(this.$input);this.$hint=e('<div class="texthint">'+this.settings.hint+"</div>").appendTo(this.$hintContainer);this.$hint.css({top:parseInt(this.$input.css("borderTopWidth"))+parseInt(this.$input.css("paddingTop")),left:parseInt(this.$input.css("borderLeftWidth"))+parseInt(this.$input.css("paddingLeft"))+1});Garnish.copyTextStyles(this.$input,this.$hint);this.val?this.$hint.hide():this.showingHint=!0;this.addListener(this.$hint,"mousedown",function(e){e.preventDefault();this.$input.focus()})}this.addListener(this.$input,"focus","onFocus");this.addListener(this.$input,"blur","onBlur");this.addListener(this.$input,"keydown","onKeyDown");this.initialized=!0},getVal:function(){this.val=this.$input.val();return this.val},showHint:function(){this.$hint.fadeIn(Garnish.NiceText.hintFadeDuration);this.showingHint=!0},hideHint:function(){this.$hint.fadeOut(Garnish.NiceText.hintFadeDuration);this.showingHint=!1},checkInput:function(){var e=this.val!==this.getVal();if(e){this.$hint&&(this.showingHint&&this.val?this.hideHint():!this.showingHint&&!this.val&&this.showHint());this.autoHeight&&this.updateHeight()}return e},buildStage:function(){this.$stage=e("<stage/>").appendTo(Garnish.$bod);this.$stage.css({display:"block",position:"absolute",top:-9999,left:-9999});this.inputBoxSizing=this.$input.css("box-sizing");this.inputBoxSizing=="border-box"&&this.$stage.css({"border-top":this.$input.css("border-top"),"border-right":this.$input.css("border-right"),"border-bottom":this.$input.css("border-bottom"),"border-left":this.$input.css("border-left"),"padding-top":this.$input.css("padding-top"),"padding-right":this.$input.css("padding-right"),"padding-bottom":this.$input.css("padding-bottom"),"padding-left":this.$input.css("padding-left"),"-webkit-box-sizing":this.inputBoxSizing,"-moz-box-sizing":this.inputBoxSizing,"box-sizing":this.inputBoxSizing});Garnish.copyTextStyles(this.$input,this.$stage)},getHeightForValue:function(e){this.$stage||this.buildStage();this.inputBoxSizing=="border-box"?this.$stage.css("width",this.$input.outerWidth()):this.$stage.css("width",this.$input.width());if(!e){e="&nbsp;";for(var t=1;t<this.$input.prop("rows");t++)e+="<br/>&nbsp;"}else{e=e.replace(/&/g,"&amp;");e=e.replace(/</g,"&lt;");e=e.replace(/>/g,"&gt;");e=e.replace(/ /g,"&nbsp;");e=e.replace(/[\n\r]$/g,"<br/>&nbsp;");e=e.replace(/[\n\r]/g,"<br/>")}this.$stage.html(e);this.inputBoxSizing=="border-box"?this.getHeightForValue._height=this.$stage.outerHeight():this.getHeightForValue._height=this.$stage.height();this.minHeight&&this.getHeightForValue._height<this.minHeight&&(this.getHeightForValue._height=this.minHeight);return this.getHeightForValue._height},updateHeight:function(){if(this.height!==(this.height=this.getHeightForValue(this.val))){this.$input.css("min-height",this.height);this.initialized&&this.onHeightChange()}},onHeightChange:function(){this.settings.onHeightChange()},onFocus:function(){this.focussed=!0;this.interval=setInterval(e.proxy(this,"checkInput"),Garnish.NiceText.interval);this.checkInput()},onBlur:function(){this.focussed=!1;clearInterval(this.interval);this.checkInput()},onKeyDown:function(){setTimeout(e.proxy(this,"checkInput"),1)},destroy:function(){this.base();this.$hint!==null&&this.$hint.remove();this.$stage!==null&&this.$stage.remove()}},{interval:100,hintFadeDuration:50,defaults:{autoHeight:!0,onHeightChange:e.noop}});Garnish.Pill=Garnish.Base.extend({$outerContainer:null,$innerContainer:null,$btns:null,$selectedBtn:null,$input:null,init:function(t){this.$outerContainer=e(t);if(this.$outerContainer.data("pill")){Garnish.log("Double-instantiating a pill on an element");this.$outerContainer.data("pill").destroy()}this.$outerContainer.data("pill",this);this.$innerContainer=this.$outerContainer.find(".btngroup:first");this.$btns=this.$innerContainer.find(".btn");this.$selectedBtn=this.$btns.filter(".active:first");this.$input=this.$outerContainer.find("input:first");Garnish.preventOutlineOnMouseFocus(this.$innerContainer);this.addListener(this.$btns,"mousedown","onMouseDown");this.addListener(this.$innerContainer,"keydown","onKeyDown")},select:function(t){this.$selectedBtn.removeClass("active");var n=e(t);n.addClass("active");this.$input.val(n.attr("data-value"));this.$selectedBtn=n},selectNext:function(){if(!this.$selectedBtn.length)this.select(this.$btns[this.$btns.length-1]);else{var e=this._getSelectedBtnIndex()+1;typeof this.$btns[e]!="undefined"&&this.select(this.$btns[e])}},selectPrev:function(){if(!this.$selectedBtn.length)this.select(this.$btns[0]);else{var e=this._getSelectedBtnIndex()-1;typeof this.$btns[e]!="undefined"&&this.select(this.$btns[e])}},onMouseDown:function(e){this.select(e.currentTarget)},_getSelectedBtnIndex:function(){return typeof this.$selectedBtn[0]!="undefined"?e.inArray(this.$selectedBtn[0],this.$btns):-1},onKeyDown:function(e){switch(e.keyCode){case Garnish.RIGHT_KEY:Garnish.ltr?this.selectNext():this.selectPrev();e.preventDefault();break;case Garnish.LEFT_KEY:Garnish.ltr?this.selectPrev():this.selectNext();e.preventDefault()}}});Garnish.Select=Garnish.Base.extend({$container:null,$items:null,totalSelected:null,mousedownX:null,mousedownY:null,mouseUpTimeout:null,callbackTimeout:null,$focusable:null,$first:null,first:null,$last:null,last:null,init:function(t,n,r){this.$container=e(t);if(!r&&e.isPlainObject(n)){r=n;n=null}if(this.$container.data("select")){Garnish.log("Double-instantiating a select on an element");this.$container.data("select").destroy()}this.$container.data("select",this);this.setSettings(r,Garnish.Select.defaults);this.$items=e();this.addItems(n);this.addListener(this.$container,"click",function(e){this.ignoreClick?this.ignoreClick=!1:this.deselectAll(!0)})},getItemIndex:function(e){return this.$items.index(e[0])},isSelected:function(e){return e.hasClass(this.settings.selectedClass)},selectItem:function(e){this.settings.multi||this.deselectAll();e.addClass(this.settings.selectedClass);this.$first=this.$last=e;this.first=this.last=this.getItemIndex(e);this.setFocusableItem(e);e.focus();this.totalSelected++;this.setCallbackTimeout()},selectAll:function(){if(!this.settings.multi||!this.$items.length)return;this.first=0;this.last=this.$items.length-1;this.$first=e(this.$items[this.first]);this.$last=e(this.$items[this.last]);this.$items.addClass(this.settings.selectedClass);this.totalSelected=this.$items.length;this.setCallbackTimeout()},selectRange:function(e){if(!this.settings.multi)return this.selectItem(e);this.deselectAll();this.$last=e;this.last=this.getItemIndex(e);this.setFocusableItem(e);e.focus();if(this.first<this.last)var t=this.first,n=this.last+1;else var t=this.last,n=this.first+1;this.$items.slice(t,n).addClass(this.settings.selectedClass);this.totalSelected=n-t;this.setCallbackTimeout()},deselectItem:function(e){e.removeClass(this.settings.selectedClass);var t=this.getItemIndex(e);this.first===t&&(this.$first=this.first=null);this.last===t&&(this.$last=this.last=null);this.totalSelected--;this.setCallbackTimeout()},deselectAll:function(e){this.$items.removeClass(this.settings.selectedClass);e&&(this.$first=this.first=this.$last=this.last=null);this.totalSelected=0;this.setCallbackTimeout()},deselectOthers:function(e){this.deselectAll();this.selectItem(e)},toggleItem:function(e){this.isSelected(e)?this.deselectItem(e):this.selectItem(e)},clearMouseUpTimeout:function(){clearTimeout(this.mouseUpTimeout)},onMouseDown:function(t){if(t.which!=Garnish.PRIMARY_CLICK)return;if(this.settings.filter&&!e(t.target).is(this.settings.filter))return;this.mousedownX=t.pageX;this.mousedownY=t.pageY;var n=e(e.data(t.currentTarget,"select-item"));t.metaKey||t.ctrlKey?this.toggleItem(n):this.first!==null&&t.shiftKey&&this.selectRange(n)},onMouseUp:function(t){if(t.which!=Garnish.PRIMARY_CLICK)return;if(this.settings.filter&&!e(t.target).is(this.settings.filter))return;var n=e(e.data(t.currentTarget,"select-item"));if(!t.metaKey&&!t.ctrlKey&&!t.shiftKey&&Garnish.getDist(this.mousedownX,this.mousedownY,t.pageX,t.pageY)<1)if(this.isSelected(n)){this.clearMouseUpTimeout();this.mouseUpTimeout=setTimeout(e.proxy(function(){this.deselectOthers(n)},this),300)}else{this.deselectAll();this.selectItem(n)}},onKeyDown:function(t){var n=t.metaKey||t.ctrlKey;if(this.settings.arrowsChangeSelection||!this.$focusable.length)var r=t.shiftKey?this.last:this.first;else{var r=e.inArray(this.$focusable[0],this.$items);r==-1&&(r=0)}switch(t.keyCode){case Garnish.LEFT_KEY:t.preventDefault();if(this.first===null)if(Garnish.ltr)var i=this.getLastItem();else var i=this.getFirstItem();else if(n)var i=this.getFurthestItemToTheLeft(r);else var i=this.getItemToTheLeft(r);break;case Garnish.RIGHT_KEY:t.preventDefault();if(this.first===null)if(Garnish.ltr)var i=this.getFirstItem();else var i=this.getLastItem();else if(n)var i=this.getFurthestItemToTheRight(r);else var i=this.getItemToTheRight(r);break;case Garnish.UP_KEY:t.preventDefault();if(this.first===null)var i=this.getLastItem();else{if(n)var i=this.getFurthestItemAbove(r);else var i=this.getItemAbove(r);i||(i=this.getFirstItem())}break;case Garnish.DOWN_KEY:t.preventDefault();if(this.first===null)var i=this.getFirstItem();else{if(n)var i=this.getFurthestItemBelow(r);else var i=this.getItemBelow(r);i||(i=this.getLastItem())}break;case Garnish.SPACE_KEY:if(!n){t.preventDefault();this.isSelected(this.$focusable)?this.deselectItem(this.$focusable):this.selectItem(this.$focusable)}break;case Garnish.A_KEY:if(n){t.preventDefault();this.selectAll()}}if(i&&i.length)if(this.settings.arrowsChangeSelection)if(this.first!==null&&t.shiftKey)this.selectRange(i);else{this.deselectAll();this.selectItem(i)}else{this.setFocusableItem(i);i.focus()}},getFirstItem:function(){if(this.$items.length)return e(this.$items[0])},getLastItem:function(){if(this.$items.length)return e(this.$items[this.$items.length-1])},isPreviousItem:function(e){return e>0},isNextItem:function(e){return e<this.$items.length-1},getPreviousItem:function(t){if(this.isPreviousItem(t))return e(this.$items[t-1])},getNextItem:function(t){if(this.isNextItem(t))return e(this.$items[t+1])},getItemToTheLeft:function(e){var t=Garnish.ltr?"Previous":"Next";if(this["is"+t+"Item"](e)){if(this.settings.horizontal)return this["get"+t+"Item"](e);if(!this.settings.vertical)return this.getClosestItem(e,Garnish.X_AXIS,"<")}},getItemToTheRight:function(e){var t=Garnish.ltr?"Next":"Previous";if(this["is"+t+"Item"](e)){if(this.settings.horizontal)return this["get"+t+"Item"](e);if(!this.settings.vertical)return this.getClosestItem(e,Garnish.X_AXIS,">")}},getItemAbove:function(e){if(this.isPreviousItem(e)){if(this.settings.vertical)return this.getPreviousItem(e);if(!this.settings.horizontal)return this.getClosestItem(e,Garnish.Y_AXIS,"<")}},getItemBelow:function(e){if(this.isNextItem(e)){if(this.settings.vertical)return this.getNextItem(e);if(!this.settings.horizontal)return this.getClosestItem(e,Garnish.Y_AXIS,">")}},getClosestItem:function(t,n,r){var i=Garnish.Select.closestItemAxisProps[n],s=Garnish.Select.closestItemDirectionProps[r],o=e(this.$items[t]),u=o.offset(),a=u[i.midpointOffset]+Math.round(o[i.midpointSizeFunc]()/2),f=null,l=null,c=null;if(Garnish.rtl&&n==Garnish.X_AXIS)var h=s.step*-1;else var h=s.step;for(var p=t+h;typeof this.$items[p]!="undefined";p+=h){var d=e(this.$items[p]),v=d.offset();if(s.isNextRow(v[i.rowOffset],u[i.rowOffset])){if(f===null)f=v[i.rowOffset];else if(v[i.rowOffset]!=f)break;var m=v[i.midpointOffset]+Math.round(d[i.midpointSizeFunc]()/2),g=Math.abs(a-m);if(!(l===null||g<l))break;l=g;c=d}else if(s.isWrongDirection(v[i.rowOffset],u[i.rowOffset]))break}return c},getFurthestItemToTheLeft:function(e){return this.getFurthestItem(e,"ToTheLeft")},getFurthestItemToTheRight:function(e){return this.getFurthestItem(e,"ToTheRight")},getFurthestItemAbove:function(e){return this.getFurthestItem(e,"Above")},getFurthestItemBelow:function(e){return this.getFurthestItem(e,"Below")},getFurthestItem:function(e,t){var n,r;while(r=this["getItem"+t](e)){n=r;e=this.getItemIndex(n)}return n},getTotalSelected:function(){return this.totalSelected},addItems:function(t){var n=e(t);for(var r=0;r<n.length;r++){var i=n[r];if(e.data(i,"select")){Garnish.log("Element was added to more than one selector");e.data(i,"select").removeItems(i)}e.data(i,"select",this);this.$items=this.$items.add(i);if(this.settings.handle){if(typeof this.settings.handle=="object")var s=e(this.settings.handle);else if(typeof this.settings.handle=="string")var s=e(i).find(this.settings.handle);else if(typeof this.settings.handle=="function")var s=e(this.settings.handle(i))}else var s=e(i);e.data(i,"select-handle",s);s.data("select-item",i);this.addListener(s,"mousedown","onMouseDown");this.addListener(s,"mouseup","onMouseUp");this.addListener(s,"keydown","onKeyDown");this.addListener(s,"click",function(e){this.ignoreClick=!0})}this.totalSelected+=n.filter("."+this.settings.selectedClass).length;this.updateIndexes()},removeItems:function(t){t=e.makeArray(t);for(var n=0;n<t.length;n++){var r=t[n],i=e.inArray(r,this.$items);if(i!=-1){var s=e.data(r,"select-handle");s.data("select-item",null);e.data(r,"select",null);e.data(r,"select-handle",null);this.removeAllListeners(s);this.$items.splice(i,1)}}this.updateIndexes()},refreshItemOrder:function(){this.$items=e(this.$items)},destroy:function(){this.base();this.clearCallbackTimeout()},updateIndexes:function(){if(this.first!==null){this.first=this.getItemIndex(this.$first);this.last=this.getItemIndex(this.$last);this.setFocusableItem(this.$first)}else this.$items.length&&this.setFocusableItem(e(this.$items[0]))},resetItemOrder:function(){this.$items=e().add(this.$items);this.updateIndexes()},setFocusableItem:function(e){this.$focusable&&this.$focusable.removeAttr("tabindex");this.$focusable=e.attr("tabindex","0")},clearCallbackTimeout:function(){this.settings.onSelectionChange&&clearTimeout(this.callbackTimeout)},setCallbackTimeout:function(){if(this.settings.onSelectionChange){this.clearCallbackTimeout();this.callbackTimeout=setTimeout(e.proxy(function(){this.callbackTimeout=null;this.settings.onSelectionChange()},this),1)}},getSelectedItems:function(){return this.$items.filter("."+this.settings.selectedClass)}},{defaults:{selectedClass:"sel",multi:!1,vertical:!1,horizontal:!1,arrowsChangeSelection:!0,handle:null,filter:null,onSelectionChange:e.noop},closestItemAxisProps:{x:{midpointOffset:"top",midpointSizeFunc:"outerHeight",rowOffset:"left"},y:{midpointOffset:"left",midpointSizeFunc:"outerWidth",rowOffset:"top"}},closestItemDirectionProps:{"<":{step:-1,isNextRow:function(e,t){return e<t},isWrongDirection:function(e,t){return e>t}},">":{step:1,isNextRow:function(e,t){return e>t},isWrongDirection:function(e,t){return e<t}}}});Garnish.SelectMenu=Garnish.Menu.extend({init:function(t,n,r,i){if(typeof r=="function"){i=r;r={}}r=e.extend({},Garnish.SelectMenu.defaults,r);this.base(t,n,r,i);this.selected=-1},build:function(){this.base();this.selected!=-1&&this._addSelectedOptionClass(this.selected)},select:function(t){if(t==this.selected)return;if(this.dom.ul){this.selected!=-1&&(this.dom.options[this.selected].className="");this._addSelectedOptionClass(t)}this.selected=t;this.setBtnText(e(this.options[t].label).text());this.base(t)},_addSelectedOptionClass:function(
e){this.dom.options[e].className="sel"},setBtnText:function(e){this.dom.$btnLabel.text(e)}},{defaults:{ulClass:"menu select"}})})(jQuery);