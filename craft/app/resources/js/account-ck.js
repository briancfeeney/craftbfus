/**
 * Craft by Pixel & Tonic
 *
 * @package   Craft
 * @author    Pixel & Tonic, Inc.
 * @copyright Copyright (c) 2014, Pixel & Tonic, Inc.
 * @license   http://buildwithcraft.com/license Craft License Agreement
 * @link      http://buildwithcraft.com
 */(function(e){var t=Garnish.Base.extend({$lockBtns:null,$currentPasswordInput:null,$spinner:null,modal:null,init:function(){this.$lockBtns=e(".btn.lock");this.addListener(this.$lockBtns,"click","showCurrentPasswordForm")},showCurrentPasswordForm:function(){if(!this.modal){var t=e('<form id="verifypasswordmodal" class="modal fitted"/>').appendTo(Garnish.$bod),n=e('<div class="body"><p>'+Craft.t("Please enter your current password.")+"</p></div>").appendTo(t),r=e('<div class="passwordwrapper"/>').appendTo(n),i=e('<div class="buttons right"/>').appendTo(n),s=e('<div class="btn">'+Craft.t("Cancel")+"</div>").appendTo(i),o=e('<input type="submit" class="btn submit" value="'+Craft.t("Continue")+'" />').appendTo(i);this.$currentPasswordInput=e('<input type="password" class="text password fullwidth"/>').appendTo(r);this.$spinner=e('<div class="spinner hidden"/>').appendTo(i);this.modal=new Garnish.Modal(t);new Craft.PasswordInput(this.$currentPasswordInput,{onToggleInput:e.proxy(function(e){this.$currentPasswordInput=e},this)});this.addListener(s,"click",function(){this.modal.hide()});this.addListener(t,"submit","submitCurrentPassword")}else this.modal.show();Garnish.isMobileBrowser(!0)||setTimeout(e.proxy(function(){this.$currentPasswordInput.focus()},this),100)},submitCurrentPassword:function(t){t.preventDefault();var n=this.$currentPasswordInput.val();if(n){this.$spinner.removeClass("hidden");var r={password:n};Craft.postActionRequest("users/verifyPassword",r,e.proxy(function(t,r){this.$spinner.addClass("hidden");if(r=="success")if(t.success){e('<input type="hidden" name="password" value="'+n+'"/>').appendTo("#userform");e("#email, #newPassword").removeClass("disabled").removeAttr("disabled");this.$lockBtns.remove();this.modal.hide()}else Garnish.shake(this.modal.$container)},this))}}});new t})(jQuery);