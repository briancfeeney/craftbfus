/*
 Copyright (c) 2014, Pixel & Tonic, Inc.
 @license   http://buildwithcraft.com/license Craft License Agreement
 @link      http://buildwithcraft.com
*/(function(e){new(Garnish.Base.extend({$lockBtns:null,$currentPasswordInput:null,$spinner:null,modal:null,init:function(){this.$lockBtns=e(".btn.lock");this.addListener(this.$lockBtns,"click","showCurrentPasswordForm")},showCurrentPasswordForm:function(){if(this.modal)this.modal.show();else{var t=e('<form id="verifypasswordmodal" class="modal fitted"/>').appendTo(Garnish.$bod),n=e('<div class="body"><p>'+Craft.t("Please enter your current password.")+"</p></div>").appendTo(t),r=e('<div class="passwordwrapper"/>').appendTo(n),n=e('<div class="buttons right"/>').appendTo(n),i=e('<div class="btn">'+Craft.t("Cancel")+"</div>").appendTo(n);e('<input type="submit" class="btn submit" value="'+Craft.t("Continue")+'" />').appendTo(n);this.$currentPasswordInput=e('<input type="password" class="text password fullwidth"/>').appendTo(r);this.$spinner=e('<div class="spinner hidden"/>').appendTo(n);this.modal=new Garnish.Modal(t);new Craft.PasswordInput(this.$currentPasswordInput,{onToggleInput:e.proxy(function(e){this.$currentPasswordInput=e},this)});this.addListener(i,"click",function(){this.modal.hide()});this.addListener(t,"submit","submitCurrentPassword")}Garnish.isMobileBrowser(!0)||setTimeout(e.proxy(function(){this.$currentPasswordInput.focus()},this),100)},submitCurrentPassword:function(t){t.preventDefault();var n=this.$currentPasswordInput.val();n&&(this.$spinner.removeClass("hidden"),Craft.postActionRequest("users/verifyPassword",{password:n},e.proxy(function(t,r){this.$spinner.addClass("hidden");"success"==r&&(t.success?(e('<input type="hidden" name="password" value="'+n+'"/>').appendTo("#userform"),e("#email, #newPassword").removeClass("disabled").removeAttr("disabled"),this.$lockBtns.remove(),this.modal.hide()):Garnish.shake(this.modal.$container))},this)))}}))})(jQuery);