/*
 Copyright (c) 2014, Pixel & Tonic, Inc.
 @license   http://buildwithcraft.com/license Craft License Agreement
 @link      http://buildwithcraft.com
*/(function(e){var t=e(".s3-key-id"),n=e(".s3-secret-key");$s3BucketSelect=e(".s3-bucket-select > select");$s3RefreshBucketsBtn=e(".s3-refresh-buckets");$s3RefreshBucketsSpinner=$s3RefreshBucketsBtn.parent().next().children();$s3UrlPrefixInput=e(".s3-url-prefix");$s3BucketLocationInput=e(".s3-bucket-location");refreshingS3Buckets=!1;$s3RefreshBucketsBtn.click(function(){if(!$s3RefreshBucketsBtn.hasClass("disabled")){$s3RefreshBucketsBtn.addClass("disabled");$s3RefreshBucketsSpinner.removeClass("hidden");var e={keyId:t.val(),secret:n.val()};Craft.postActionRequest("assetSources/getS3Buckets",e,function(e,t){$s3RefreshBucketsBtn.removeClass("disabled");$s3RefreshBucketsSpinner.addClass("hidden");if("success"==t)if(e.error)alert(e.error);else if(0<e.length){var n=$s3BucketSelect.val(),r=!1;refreshingS3Buckets=!0;$s3BucketSelect.prop("disabled",!1).empty();for(var i=0;i<e.length;i++)e[i].bucket==n&&(r=!0),$s3BucketSelect.append('<option value="'+e[i].bucket+'" data-url-prefix="'+e[i].url_prefix+'" data-location="'+e[i].location+'">'+e[i].bucket+"</option>");r&&$s3BucketSelect.val(n);refreshingS3Buckets=!1;r||$s3BucketSelect.trigger("change")}})}});$s3BucketSelect.change(function(){if(!refreshingS3Buckets){var e=$s3BucketSelect.children("option:selected");$s3UrlPrefixInput.val(e.data("url-prefix"));$s3BucketLocationInput.val(e.data("location"))}});var r=e(".rackspace-username"),i=e(".racskspace-api-key"),s=e(".rackspace-region-select > select"),o=e(".rackspace-refresh-regions"),u=o.parent().next().children(),a=e(".rackspace-container-select > select"),f=e(".rackspace-refresh-containers"),l=f.parent().next().children(),c=e(".rackspace-url-prefix"),h=!1;o.click(function(){if(!o.hasClass("disabled")){o.addClass("disabled");u.removeClass("hidden");var e={username:r.val(),apiKey:i.val()};Craft.postActionRequest("assetSources/getRackspaceRegions",e,function(e,t){o.removeClass("disabled");u.addClass("hidden");if("success"==t)if(e.error)alert(e.error);else if(0<e.length){var n=s.val(),r=!1;s.prop("disabled",!1).empty();for(var i=0;i<e.length;i++)e[i]==n&&(r=!0),s.append('<option value="'+e[i]+'">'+e[i]+"</option>");r&&s.val(n)}})}});f.click(function(){if("-"==s.val())alert(Craft.t("Select a region first!"));else if(!f.hasClass("disabled")){f.addClass("disabled");l.removeClass("hidden");var e={username:r.val(),apiKey:i.val(),region:s.val()};Craft.postActionRequest("assetSources/getRackspaceContainers",e,function(e,t){f.removeClass("disabled");l.addClass("hidden");if("success"==t)if(e.error)alert(e.error);else if(0<e.length){var n=a.val(),r=!1;h=!0;a.prop("disabled",!1).empty();for(var i=0;i<e.length;i++)e[i].container==n&&(r=!0),a.append('<option value="'+e[i].container+'" data-urlprefix="'+e[i].urlPrefix+'">'+e[i].container+"</option>");r&&a.val(n);h=!1;r||a.trigger("change")}})}});a.change(function(){if(!h){var e=a.children("option:selected");c.val(e.data("urlprefix"))}});var p=e(".google-key-id"),d=e(".google-secret-key");$googleBucketSelect=e(".google-bucket-select > select");$googleRefreshBucketsBtn=e(".google-refresh-buckets");$googleRefreshBucketsSpinner=$googleRefreshBucketsBtn.parent().next().children();$googleUrlPrefixInput=e(".google-url-prefix");refreshingGoogleBuckets=!1;$googleRefreshBucketsBtn.click(function(){if(!$googleRefreshBucketsBtn.hasClass("disabled")){$googleRefreshBucketsBtn.addClass("disabled");$googleRefreshBucketsSpinner.removeClass("hidden");var e={keyId:p.val(),secret:d.val()};Craft.postActionRequest("assetSources/getGoogleCloudBuckets",e,function(e,t){$googleRefreshBucketsBtn.removeClass("disabled");$googleRefreshBucketsSpinner.addClass("hidden");if("success"==t)if(e.error)alert(e.error);else if(0<e.length){var n=$googleBucketSelect.val(),r=!1;refreshingGoogleBuckets=!0;$googleBucketSelect.prop("disabled",!1).empty();for(var i=0;i<e.length;i++)e[i].bucket==n&&(r=!0),$googleBucketSelect.append('<option value="'+e[i].bucket+'" data-url-prefix="'+e[i].url_prefix+'">'+e[i].bucket+"</option>");r&&$googleBucketSelect.val(n);refreshingGoogleBuckets=!1;r||$googleBucketSelect.trigger("change")}})}});$googleBucketSelect.change(function(){if(!refreshingGoogleBuckets){var e=$googleBucketSelect.children("option:selected");$googleUrlPrefixInput.val(e.data("url-prefix"))}});var v=function(){var t=e(this).parents(".field"),n=t.find(".expires-amount").val(),r=t.find(".expires-period select").val(),n=0==parseInt(n,10)||0==r.length?"":n+r;t.find("[type=hidden]").val(n)};e(".expires-amount").keyup(v).change(v);e(".expires-period select").change(v)})(jQuery);