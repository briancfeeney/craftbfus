/**
 * Craft by Pixel & Tonic
 *
 * @package   Craft
 * @author    Pixel & Tonic, Inc.
 * @copyright Copyright (c) 2014, Pixel & Tonic, Inc.
 * @license   http://buildwithcraft.com/license Craft License Agreement
 * @link      http://buildwithcraft.com
 */(function(e){var t=Garnish.Base.extend({$form:null,$protocolField:null,$protocolSelect:null,$hiddenFields:null,$testBtn:null,$testSpinner:null,$protocolSettingsPane:null,$protocolSettingsPaneHead:null,$protocolSettingsPaneBody:null,protocol:null,init:function(){this.$form=e("#settings-form");this.$protocolField=e("#protocol-field");this.$protocolSelect=e("#protocol");this.$hiddenFields=e("#hidden-fields");this.$testBtn=e("#test");this.$testSpinner=e("#test-spinner");this._onEmailTypeChange();this.addListener(this.$protocolSelect,"change","_onEmailTypeChange");this.addListener(this.$testBtn,"activate","sendTestEmail")},getField:function(n){return e("#"+t.protocolFields[this.protocol][n]+"-field")},_onEmailTypeChange:function(){if(this.protocol&&this.protocol in t.protocolFields)for(var e=0;e<t.protocolFields[this.protocol].length;e++)this.getField(e).appendTo(this.$hiddenFields);this.protocol=this.$protocolSelect.val();if(this.protocol in t.protocolFields){var n=this.$protocolField;for(var r=0;r<t.protocolFields[this.protocol].length;r++){var i=this.getField(r);i.insertAfter(n);n=i}}},sendTestEmail:function(){if(this.$testBtn.hasClass("sel"))return;this.$testBtn.addClass("sel");this.$testSpinner.removeClass("hidden");var t=Garnish.getPostData(this.$form);delete t.action;Craft.postActionRequest("systemSettings/testEmailSettings",t,e.proxy(function(e,t){this.$testBtn.removeClass("sel");this.$testSpinner.addClass("hidden");t=="success"&&(e.success?Craft.cp.displayNotice(Craft.t("Email sent successfully! Check your inbox.")):Craft.cp.displayError(e.error))},this))}},{protocolFields:{smtp:["host","port","smtpKeepAlive","smtpAuth","smtpAuthCredentials","smtpSecureTransportType","timeout"],pop:["username","password","host","port","timeout"],gmail:["username","password"]}});Craft.emailSettingsForm=new t})(jQuery);